(function(){const e=document.getElementById("site-nav");if(!e)return;const t=()=>{window.scrollY>0?e.classList.add("is-scrolled"):e.classList.remove("is-scrolled")};window.addEventListener("scroll",t,{passive:!0}),t()})(),function(){const e=document.querySelector(".hero.has-hero-bg");if(!e)return;const t=e.getAttribute("data-bg");t&&t.trim()!==""&&e.style.setProperty("--hero-bg-url",`url("${t}")`)}(),function(){const e=document.getElementById("site-nav");if(!e)return;const n=e.querySelector(".nav__toggle"),o=e.querySelector(".nav__menu");if(!n||!o)return;const t=window.matchMedia("(min-width: 1024px)");function s(){e.classList.remove("is-open"),n.setAttribute("aria-expanded","false")}function a(){e.classList.add("is-open"),n.setAttribute("aria-expanded","true")}function r(){const t=e.classList.contains("is-open");t?s():a()}n.addEventListener("click",e=>{e.preventDefault(),r()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&s()}),o.addEventListener("click",e=>{const n=e.target.closest("a");if(!n)return;t.matches||s()});const i=()=>{t.matches&&s()};t.addEventListener?t.addEventListener("change",i):t.addListener(i)}(),(()=>{const n=window.matchMedia("(min-width: 1024px)"),e=document.querySelector(".nav__toggle");if(!e)return;const t="nav__backdrop";function o(){if(document.querySelector("."+t))return;const n=document.createElement("div");n.className=t,n.addEventListener("click",()=>{e.click()},{passive:!0}),document.body.appendChild(n)}function s(){const e=document.querySelector("."+t);e&&e.remove()}const i=new MutationObserver(()=>{const t=e.getAttribute("aria-expanded")==="true";t&&!n.matches?o():s()});i.observe(e,{attributes:!0,attributeFilter:["aria-expanded"]}),n.addEventListener?.("change",e=>{e.matches&&s()})})(),function(){const e=document.querySelector(".hero-cta--chevrons");if(!e)return;if(e.dataset.chevronsBound==="1")return;e.dataset.chevronsBound="1";const t=window.matchMedia("(max-width: 767.98px)"),n=e=>{if(t.matches){e.preventDefault();const t=document.getElementById("hero-chevron-target");if(!t)return;t.scrollIntoView({behavior:"smooth",block:"start"})}};e.addEventListener("click",n,{passive:!1})}(),function(){const e=document.querySelector(".sub-hero");if(!e)return;if(e.dataset.pagerReady==="1")return;e.dataset.pagerReady="1",document.querySelectorAll(".pager__dots, .pager__controls").forEach(t=>{e.contains(t)||(t.style.display="none",t.setAttribute("aria-hidden","true"))});const r=e.querySelector(".pager__viewport")||e,E=e.querySelector(".pager__track"),n=Array.from(E?E.querySelectorAll(".pager__slide"):[]),S=Array.from(e.querySelectorAll(".pager__dots"));S.length>1&&S.slice(1).forEach(e=>e.remove());const F=Array.from(e.querySelectorAll(".pager__controls"));F.length>1&&F.slice(1).forEach(e=>e.remove());const a=e.querySelector(".pager__dots"),t=e.querySelector(".pager__controls"),M=e.querySelector("#carousel-status");let y=null;function N(){try{const t=document.querySelector(".cards__inner")||document.querySelector(".links__inner");if(!t){e.style.removeProperty("--subhero-align-left");return}const{left:n}=t.getBoundingClientRect(),s=Math.max(0,Math.round(n));e.style.setProperty("--subhero-align-left",s+"px")}catch{e.style.removeProperty("--subhero-align-left")}}let b=0;function _(){if(b)return;b=requestAnimationFrame(()=>{b=0,N()})}const w=window.matchMedia("(prefers-reduced-motion: reduce)"),P=w.matches?80:420,H=7e3;let A=!w.matches,i=Math.max(0,n.findIndex(e=>e.classList.contains("is-active")));i<0&&(i=0),r.style.overflow="hidden",r.style.touchAction="pan-y";const W=e=>(e+n.length)%n.length;function B(){n.forEach(e=>{const t=e.getAttribute("data-bg-mobile"),n=e.getAttribute("data-bg-desktop");t&&t.trim()!==""&&e.style.setProperty("--slide-bg-mobile-url",`url("${t}")`),n&&n.trim()!==""&&e.style.setProperty("--slide-bg-desktop-url",`url("${n}")`)})}function U(){e.setAttribute("aria-roledescription","carousel"),n.forEach((e,t)=>{e.setAttribute("role","group"),e.setAttribute("aria-roledescription","slide");const s=e.querySelector(".slide__title")?.textContent?.trim()||`Slide ${t+1}`;e.setAttribute("aria-label",`Slide ${t+1} di ${n.length}: ${s}`),e.id=e.id||`subhero-slide-${t+1}`})}function D(e){if(!M)return;const t=n[e],s=t?.querySelector(".slide__title")?.textContent?.trim()||`Slide ${e+1}`;M.textContent=`Slide ${e+1} di ${n.length}: ${s}`}const l=a?Array.from(a.querySelectorAll("button, .dot")):[];function V(){if(!a||!n?.length)return;a.setAttribute("role","tablist");const e=n.length;l.forEach((t,s)=>{t.setAttribute("role","tab"),t.setAttribute("aria-controls",n[s]?.id||`subhero-slide-${s+1}`),t.setAttribute("aria-label",`Vai alla slide ${s+1} di ${e}`)})}function x(){if(!l.length)return;const e=["is-progress","is-filling","is-paused"];l.forEach((t,n)=>{e.forEach(e=>t.classList.remove(e));const s=n===i;t.classList.toggle("is-active",s),t.setAttribute("aria-selected",s?"true":"false"),t.setAttribute("aria-current",s?"true":"false"),t.setAttribute("tabindex",s?"0":"-1")})}function R(){l.forEach((e,t)=>{e.setAttribute("role","tab"),e.setAttribute("aria-controls",`subhero-slide-${t+1}`),e.addEventListener("click",()=>{s(),m(t,!0),o()}),e.addEventListener("keydown",e=>{e.key==="ArrowLeft"&&(e.preventDefault(),s(),p(!0),o()),e.key==="ArrowRight"&&(e.preventDefault(),s(),f(!0),o())})}),x()}function I(){n.forEach((e,t)=>{e.querySelectorAll("img").forEach(e=>{t===0?(e.loading="eager",e.fetchPriority="high",e.decoding="async"):(e.loading="lazy",e.decoding="async")})})}function j(){const e=n.reduce((e,t)=>Math.max(e,t.scrollHeight),0),t=Math.max(200,Math.min(420,e));r.style.height=t+"px"}const g=window.matchMedia("(min-width: 768px)"),u=window.matchMedia("(max-width: 767.98px)");function O(){if(!t&&!a)return;u.matches?t&&(t.style.display="none",t.style.visibility="hidden",t.style.pointerEvents="none",t.setAttribute("aria-hidden","true"),t.querySelectorAll(".pager__arrow").forEach(e=>e.setAttribute("tabindex","-1"))):t&&(t.style.display="",t.style.visibility="",t.style.pointerEvents="",t.removeAttribute("aria-hidden"),t.querySelectorAll(".pager__arrow").forEach(e=>e.removeAttribute("tabindex")))}function c(){if(!t||u.matches)return;t.style.top=""}function m(e,t=!1){const a=W(e);if(a===i)return;const s=n[i],o=n[a];if(!o)return;s&&s.classList.add("is-animating"),o.classList.add("is-animating"),s&&s.classList.remove("is-active"),o.classList.add("is-active"),i=a,x(),c?.(),(t||!w.matches)&&D(i),window.setTimeout(()=>{s&&s.classList.remove("is-animating"),o.classList.remove("is-animating")},P+60)}const z=(e,t=!1)=>m(e,t),f=(e=!1)=>z(i+1,e),p=(e=!1)=>z(i-1,e);let d=null;function o(){if(!A||d)return;d=setInterval(()=>m(i+1),H),e.dataset.autoplay="1"}function s(){if(!d)return;clearInterval(d),d=null,e.dataset.autoplay="0"}let C;"IntersectionObserver"in window&&(C=new IntersectionObserver(e=>{const t=e[0];if(!t)return;t.isIntersecting&&t.intersectionRatio>=.35?o():s()},{root:null,threshold:[0,.35,1]}),C.observe(e)),document.addEventListener("visibilitychange",()=>{document.hidden?s():C||o()}),R(),e.addEventListener("click",t=>{const n=t.target.closest(".pager__arrow");if(!n||!e.contains(n))return;t.preventDefault(),s(),n.classList.contains("prev")?p(!0):n.classList.contains("next")&&f(!0),n.focus(),o()}),document.addEventListener("keydown",e=>{const n=document.activeElement,i=n?.tagName?.toLowerCase(),a=i==="input"||i==="textarea"||n?.isContentEditable,t=e.target.closest?.(".pager__arrow");if(t&&(e.key==="Enter"||e.key===" "||e.code==="Space")){e.preventDefault(),s(),t.classList.contains("prev")?p(!0):t.classList.contains("next")&&f(!0),t.focus(),o();return}a||(e.key==="ArrowLeft"&&(e.preventDefault(),s(),p(!0),o()),e.key==="ArrowRight"&&(e.preventDefault(),s(),f(!0),o()))}),e.addEventListener("pointerenter",s),e.addEventListener("pointerleave",o),e.addEventListener("focusin",s),e.addEventListener("focusout",o);let k=0,h=0,v=!1;r.addEventListener("touchstart",e=>{if(!e.touches?.length)return;v=!0,k=e.touches[0].clientX,h=0,s()},{passive:!0}),r.addEventListener("touchmove",e=>{if(!v||!e.touches?.length)return;h=e.touches[0].clientX-k},{passive:!0}),r.addEventListener("touchend",()=>{if(!v)return;v=!1,Math.abs(h)>40&&m(i+(h<0?1:-1),!0),o()},{passive:!0});function $(){if(n.length>1)return;A=!1,s(),a&&(a.style.display="none"),t&&(t.style.display="none"),a&&a.setAttribute("aria-hidden","true"),l.forEach(e=>e.setAttribute("tabindex","-1")),t&&(t.setAttribute("aria-hidden","true"),t.querySelectorAll(".pager__arrow").forEach(e=>e.setAttribute("tabindex","-1")))}const T=()=>{g.matches&&c?.()};g.addEventListener?g.addEventListener("change",T):g.addListener(T),u.addEventListener?u.addEventListener("change",O):u.addListener(O),B(),U(),V(),x(),I(),j(),D(i),$(),O(),o(),N();const L=document.querySelector(".cards__inner")||document.querySelector(".links__inner");if("ResizeObserver"in window&&(y=new ResizeObserver(()=>_()),L&&y.observe(L),y.observe(document.documentElement)),window.addEventListener("resize",_),window.addEventListener("load",_),window.requestAnimationFrame(()=>{c?.()}),window.addEventListener("load",()=>{c?.()}),"ResizeObserver"in window){const e=new ResizeObserver(()=>{j(),c?.()});n.forEach(t=>e.observe(t)),e.observe(r)}else window.addEventListener("resize",()=>{j(),c?.()})}(),(()=>{const t=1024,n=3e3,s=24,o=8;function e(){const a=document.querySelector(".links");if(!a)return;const j=a.querySelector(".links__carousel")||a,e=a.querySelector(".links__track");if(!e)return;e.setAttribute("tabindex","0"),e.setAttribute("aria-label","Elenco collegamenti scorrevole orizzontale");const m=window.matchMedia(`(min-width: ${t}px)`),F=window.matchMedia("(prefers-reduced-motion: reduce)");let H=16,h=240,l=0,r=0,p=!1,i=0,g=480,w=!1,f=!1,U=0,q=0,y=null,z="",u=0,d=0,c=!1,C=0,E="",v=null;const K=(e,t=a)=>{const s=getComputedStyle(t).getPropertyValue(e).trim(),n=parseFloat(s);return Number.isFinite(n)?n:0},ie=()=>{const e=K("--links-auto-speed",a);return Number.isFinite(e)&&e>0?Math.max(8,Math.min(120,e)):s},M=()=>K("--links-auto-ignore-rmw",a)>0,ae=e=>!!e&&(e.dataset&&e.dataset.clone==="1"||e.classList.contains("is-clone")),T=()=>Array.from(e.querySelectorAll(".link-card")).filter(e=>!ae(e)),V=()=>{e.querySelectorAll('.link-card[data-clone="1"], .link-card.is-clone').forEach(e=>e.remove())},D=e=>{const t=document.createDocumentFragment();return e.forEach(e=>{const n=e.cloneNode(!0);n.dataset.clone="1",n.classList.add("is-clone"),n.setAttribute("aria-hidden","true"),n.removeAttribute("id"),n.querySelectorAll("a,button").forEach(e=>e.setAttribute("tabindex","-1")),t.appendChild(n)}),t},G=()=>{const t=getComputedStyle(e);H=parseFloat(t.columnGap)||parseFloat(t.gap)||0;const n=e.querySelector(".link-card");if(n){const e=n.getBoundingClientRect();h=Math.round(e.width+H)}},L=()=>{const e=T();if(!e.length){l=0,r=0;return}const n=e[0],t=e[e.length-1];r=n.offsetLeft;const s=t.offsetLeft+t.getBoundingClientRect().width;l=Math.max(0,Math.round(s-r))},R=()=>{const t=j.clientWidth||e.clientWidth||0;g=Math.max(h*3,Math.round(t*.5))},de=()=>{e.style.flexWrap="nowrap",e.style.justifyContent="flex-start",e.style.overflowX="auto",e.style.overflowY="hidden",e.style.webkitOverflowScrolling="touch",e.style.scrollSnapType="x proximity",e.style.touchAction="none",e.style.userSelect="none",e.classList.add("is-initializing")},le=()=>{e.style.flexWrap="",e.style.justifyContent="",e.style.overflowX="",e.style.overflowY="",e.style.webkitOverflowScrolling="",e.style.scrollSnapType="",e.style.touchAction="",e.style.userSelect="",e.classList.remove("is-initializing","is-ready","is-dragging")},I=()=>{V();const t=T();if(t.length<1){p=!1;return}G(),L(),R();const n=j.clientWidth||e.clientWidth||0;let s=n+2*g+2*l+Math.max(h,1),o=0;const a=10;for(;(e.scrollWidth||0)<s&&o<a;)e.insertBefore(D(t),t[0]),e.appendChild(D(t)),o++,G(),L(),R(),s=n+2*g+2*l+Math.max(h,1);e.scrollTo({left:r,behavior:"auto"}),i=e.scrollLeft,p=!0},B=()=>{if(!p||l<=0)return;const t=r-g,n=r+l+g;if(i>=t&&i<n)return;const s=i-r,o=(s%l+l)%l;i=r+o,e.scrollLeft=i},_=t=>{c=!!t,c?E&&(e.style.scrollSnapType=E):(E=e.style.scrollSnapType||"",e.style.scrollSnapType="none")},x=()=>{_(!0),C&&clearTimeout(C),C=window.setTimeout(()=>_(!1),n)},W=t=>{u=requestAnimationFrame(W);const o=F.matches&&!M();if(c||o||document.visibilityState==="hidden"){d=t;return}if(!d){d=t;return}const n=(t-d)/1e3;if(n<=0){d=t;return}d=t;const s=ie();if(s<=0)return;i+=s*n,e.scrollLeft=i,B()},S=()=>{u||(d=0,_(!1),u=requestAnimationFrame(W))},A=()=>{u&&cancelAnimationFrame(u),u=0,_(!0)},k=F.matches&&!M()?"auto":"smooth",Y=t=>{e.scrollBy({left:t*h,behavior:k}),x()},N=t=>{switch(t.key){case"ArrowLeft":t.preventDefault(),Y(-1);break;case"ArrowRight":t.preventDefault(),Y(1);break;case"Home":t.preventDefault(),e.scrollTo({left:r,behavior:k}),x();break;case"End":t.preventDefault(),e.scrollTo({left:e.scrollWidth,behavior:k}),x();break}},X=t=>{e.scrollWidth>e.clientWidth&&(t.preventDefault(),e.scrollLeft+=t.deltaY,i=e.scrollLeft,x())},Q=t=>{if(t.button!==0)return;w=!0,f=!1,U=t.clientX,q=e.scrollLeft,c=!0,z=e.style.scrollSnapType||"",e.style.scrollSnapType="none"},Z=t=>{if(!w)return;const n=t.clientX-U;if(!f&&(n<0?-n:n)>o){f=!0,e.classList.add("is-dragging");try{e.setPointerCapture(t.pointerId),y=t.pointerId}catch{}}f&&(e.scrollLeft=q-n,i=e.scrollLeft,t.preventDefault())},J=t=>{if(!w)return;if(f&&(e.classList.remove("is-dragging"),y!=null)){try{e.releasePointerCapture(y)}catch{}y=null}e.style.scrollSnapType=z||"",z="",requestAnimationFrame(()=>{c=!1}),w=!1,f=!1},oe=()=>{c=!0},se=()=>{c=!1},ne=()=>oe(),te=()=>se();let ee;const b=()=>{clearTimeout(ee),ee=setTimeout(()=>{if(!p)return;const t=(i||e.scrollLeft)-r;I(),i=r+t,e.scrollLeft=i},50)},$=()=>{if(document.hidden)u&&A();else{const e=F.matches&&!M();m.matches&&!e&&a.dataset.linksReady==="1"&&S()}},re=()=>{if(a.dataset.linksReady==="1")return;a.dataset.linksReady="1",j.dataset.linksReady="1",de(),I(),e.addEventListener("keydown",N),e.addEventListener("wheel",X,{passive:!1}),e.addEventListener("pointerdown",Q,{passive:!1}),window.addEventListener("pointermove",Z,{passive:!1}),window.addEventListener("pointerup",J,{passive:!1}),window.addEventListener("resize",b,{passive:!0}),e.addEventListener("mouseenter",ne),e.addEventListener("mouseleave",te),e.querySelectorAll("img").forEach(e=>{e.addEventListener("load",b,{passive:!0})}),"IntersectionObserver"in window&&(v=new IntersectionObserver(e=>{const t=e[0];if(!t)return;t.intersectionRatio<.3?c=!0:c=!1},{root:null,threshold:[0,.3,1]}),v.observe(a)),document.addEventListener("visibilitychange",$),S(),requestAnimationFrame(()=>{e.classList.remove("is-initializing"),e.classList.add("is-ready");const t=e.scrollLeft,n=Math.max(8,Math.round(h*.1));i=t+n,e.scrollLeft=i,B(),setTimeout(()=>{const n=e.scrollLeft;Math.abs(n-t)<1&&(A(),d=0,S())},700)})},ce=()=>{if(!a.dataset.linksReady)return;if(delete a.dataset.linksReady,delete j.dataset.linksReady,A(),e.removeEventListener("keydown",N),e.removeEventListener("wheel",X),e.removeEventListener("pointerdown",Q),window.removeEventListener("pointermove",Z),window.removeEventListener("pointerup",J),window.removeEventListener("resize",b),e.querySelectorAll("img").forEach(e=>{e.removeEventListener("load",b)}),e.removeEventListener("mouseenter",ne),e.removeEventListener("mouseleave",te),document.removeEventListener("visibilitychange",$),v){try{v.disconnect()}catch{}v=null}le(),V(),e.scrollTo({left:0,behavior:"auto"}),i=0,p=!1},O=()=>{const e=T().length>0;m.matches&&e?re():ce()};let P;const ue=()=>{clearTimeout(P),P=setTimeout(O,120)};window.addEventListener("resize",ue,{passive:!0}),O(),m.addEventListener?m.addEventListener("change",O):m.addListener&&m.addListener(O)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e,{once:!0}):e()})(),(()=>{"use strict";if(!document.querySelector("section.archive"))return;const c="(max-width: 1023.98px)",l="(max-width: 768px)",s="true",n="false",e=(e,t=document)=>t.querySelector(e),a=(e,t=document)=>Array.from(t.querySelectorAll(e)),t=(e,t,n,s)=>e&&e.addEventListener(t,n,s),d=(e,t,n)=>e&&e.setAttribute(t,String(n)),o=window.matchMedia?window.matchMedia(c):{matches:!0,addEventListener(){}},i=window.matchMedia?window.matchMedia(l):{matches:!1,addEventListener(){}},u=()=>new URL(window.location.href),r=e=>u().searchParams.get(e);(()=>{const n=e(".archive-sheet"),l=e(".archive-sheet-backdrop");if(!n||!l)return;const m=e(".archive-sheet__close",n),s=e(".archive-sheet__handle",n),j=e("#archive-sheet-title",n),b=e(".archive-sheet__content",n),h=e(".archive-sheet__ctas",n);let c=null;const u=e=>{if(e.key!=="Tab")return;const t=a('a, button, input, select, textarea, [tabindex]:not([tabindex="-1"])',n).filter(e=>!e.hasAttribute("disabled")&&e.getAttribute("aria-hidden")!=="true");if(!t.length)return;const s=t[0],o=t[t.length-1];e.shiftKey&&document.activeElement===s?(o.focus(),e.preventDefault()):!e.shiftKey&&document.activeElement===o&&(s.focus(),e.preventDefault())},v=e=>{if(!o.matches)return;c=document.activeElement,j.textContent=e.title||"",b.innerHTML=e.descHtml||"",h.innerHTML="",(e.links||[]).forEach(e=>{const t=document.createElement("a");t.className=e.cls||"pill btn--base",t.href=e.url,t.target="_blank",t.rel="noopener",t.title=e.lab||"Apri",t.textContent=e.lab||"Apri",h.appendChild(t)}),n.setAttribute("aria-hidden","false"),l.setAttribute("aria-hidden","false"),document.body.classList.add("no-scroll"),n.addEventListener("keydown",u),(m||n).focus()},d=()=>{n.setAttribute("aria-hidden","true"),l.setAttribute("aria-hidden","true"),document.body.classList.remove("no-scroll"),n.removeEventListener("keydown",u),c&&typeof c.focus=="function"&&c.focus()};t(m,"click",d),t(l,"click",d);let i=null,r=null;const f=e=>{i=e.touches?e.touches[0].clientY:e.clientY,r=i},p=e=>{if(i==null)return;r=e.touches?e.touches[0].clientY:e.clientY},g=()=>{i!=null&&r!=null&&r-i>60&&d(),i=r=null};t(s,"mousedown",f),t(s,"mousemove",p),t(s,"mouseup",g),t(s,"touchstart",f,{passive:!0}),t(s,"touchmove",p,{passive:!0}),t(s,"touchend",g),document.addEventListener("click",e=>{const s=e.target&&e.target.closest(".item-actions-summary");if(!s||!o.matches)return;const n=s.closest(".item"),i=n&&n.closest(".archive-item");if(!i)return;const t=i.querySelector(".item-panel"),r=t?t.querySelector(".item-summary"):null,c=t?a(".item-ctas a",t):[],l=n.querySelector(".item-title")?.textContent||"",d=c.map(e=>({url:e.getAttribute("href"),lab:e.textContent.trim(),cls:e.className}));v({title:l,descHtml:r?`<p class="item-summary">${r.textContent}</p>`:"",links:d}),e.preventDefault()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&n.getAttribute("aria-hidden")==="false"&&d()})})(),(()=>{const t=window.matchMedia?window.matchMedia("(max-width: 1023.98px)"):{matches:!0},o=o=>{if(t.matches)return;const i=o.target&&o.target.closest(".item");if(!i)return;const r=i.closest(".archive-item");if(!r)return;const c=e(".item-panel",r),l=e(".item-actions-summary",i);if(!c||!l)return;const a=!i.classList.contains("is-open");i.classList.toggle("is-open",a),d(l,"aria-expanded",a?s:n);try{c.hidden=!a}catch{}};document.addEventListener("click",e=>{const n=e.target&&e.target.closest(".item-actions-summary");if(!n)return;t.matches||o(e)})})(),(()=>{const t=e("#archive-search-form");if(!t)return;const n=e("#q",t),s=()=>{if(!n)return;n.placeholder=i.matches?"Cerca":"Cerca per titolo, descrizione o tag…"};s(),i.addEventListener&&i.addEventListener("change",s)})(),(()=>{const l=e("#archive-search-form"),u=e("#q",l||document),c=e("#kind",l||document),i=e(".archive-search__filter-toggle",l||document),h=(r("kind")||"").toLowerCase();c&&(c.value=h==="video"||h==="content"?h:"");const m=!!(c&&c.value!=="");i&&(i.setAttribute("aria-pressed",m?s:n),i.classList.toggle("is-active",m),i.setAttribute("aria-expanded",n)),u&&(u.value=r("q")||"");let a=null;const d=()=>{a&&a.parentNode&&a.parentNode.removeChild(a),a=null,i&&i.setAttribute("aria-expanded",n),document.removeEventListener("click",f,!0),document.removeEventListener("keydown",p,!0)},f=e=>{if(!a)return;const t=e.target&&(a.contains(e.target)||i&&i.contains(e.target));t||d()},p=e=>{e.key==="Escape"&&d()},g=()=>{a&&d(),a=document.createElement("div"),a.className="filter-popover",a.setAttribute("role","menu"),a.setAttribute("aria-label","Filtro contenuti");const e=c?c.value:"";a.innerHTML=`
        <ul class="filter-popover__list" role="none">
          <li role="none">
            <button type="button" class="filter-popover__item" role="menuitemradio" aria-checked="${e===""?"true":"false"}" data-value="">Tutti</button>
          </li>
          <li role="none">
            <button type="button" class="filter-popover__item" role="menuitemradio" aria-checked="${e==="video"?"true":"false"}" data-value="video">Video</button>
          </li>
          <li role="none">
            <button type="button" class="filter-popover__item" role="menuitemradio" aria-checked="${e==="content"?"true":"false"}" data-value="content">Contenuti</button>
          </li>
        </ul>
      `,document.body.appendChild(a);const t=i.getBoundingClientRect(),l=8,o=Math.max(t.width,180),u=Math.max(8,Math.min(window.innerWidth-o-8,t.left));Object.assign(a.style,{position:"fixed",top:`${Math.min(window.innerHeight-8,t.bottom+l)}px`,left:`${u}px`,minWidth:`${o}px`,zIndex:"10000"});const r=a.querySelector('.filter-popover__item[aria-checked="true"]')||a.querySelector(".filter-popover__item");r&&r.focus({preventScroll:!0}),document.addEventListener("click",f,!0),document.addEventListener("keydown",p,!0),a.addEventListener("click",e=>{const o=e.target&&e.target.closest(".filter-popover__item");if(!o)return;const t=(o.getAttribute("data-value")||"").toLowerCase();if(c){c.value=t==="video"||t==="content"?t:"";const e=c.value!=="";i&&(i.setAttribute("aria-pressed",e?s:n),i.classList.toggle("is-active",e))}d(),i&&i.focus()}),i&&i.setAttribute("aria-expanded",s)};document.addEventListener("click",e=>{const t=e.target&&e.target.closest(".archive-search__filter-toggle");if(!t)return;if(o.matches)e.preventDefault(),a?d():g();else{const e=document.getElementById("kind");e&&e.focus()}}),l&&t(l,"submit",()=>{try{const e=new URL(l.action||window.location.href);e.searchParams.delete("p"),l.action=e.toString()}catch{}}),document.addEventListener("click",e=>{const s=e.target&&e.target.closest(".archive-search__reset");if(!s)return;e.preventDefault(),d();const t=new URL(window.location.href);t.searchParams.delete("q"),t.searchParams.delete("p"),t.searchParams.delete("kind"),u&&(u.value=""),c&&(c.value=""),i&&(i.setAttribute("aria-pressed",n),i.classList.remove("is-active"),i.setAttribute("aria-expanded",n)),window.location.href=t.toString()})})()})(),(()=>{"use strict";if(!document.querySelector("section.archive"))return;const l=(e,t=document)=>t.querySelector(e),s=e=>e==null?"":String(e),e=e=>s(e).toLowerCase(),t=e=>s(e).trim(),a=()=>new URL(window.location.href),n=e=>a().searchParams.get(e),o=(t,n)=>e(t).includes(e(n)),r=e=>/^(data:|https?:|\/\/)/i.test(e),k=(e,t)=>r(e)?e:e+(t?`?v=${t}`:""),_=t=>{const n=Array.isArray(t)?t:[],s=n.map(t=>e(t)).join(",");return`,${s},`},j=(t,n)=>{const o=_(t),s=e(n).trim();if(!s)return!1;const i=s.split(/\s+/).filter(Boolean);for(let e=0;e<i.length;e++)if(o.includes(i[e]))return!0;return!!o.includes(s)},d=n=>{const s=e(t(n));if(!s)return"btn--base";const i=s.match(/\bbtn--[a-z0-9-]+\b/);if(i)return i[0];const o={youtube:"btn--yt",yt:"btn--yt",scryfall:"btn--scry",scry:"btn--scry",edhrec:"btn--edh",edh:"btn--edh",moxfield:"btn--mox",mox:"btn--mox",archidekt:"btn--archi",archi:"btn--archi",teal:"btn--teal",gold:"btn--gold",primary:"primary",indigo:"btn--base",base:"btn--base",default:"btn--base"},a=s.split(/\s+/);for(const e of a)if(o[e])return o[e];for(const e in o)if(s.includes(e))return o[e];return"btn--base"},h=e=>{try{const t=new URL(e,window.location.origin).host.toLowerCase();if(t.includes("youtube.com")||t.includes("youtu.be"))return"btn--yt";if(t.includes("scryfall.com"))return"btn--scry";if(t.includes("edhrec.com"))return"btn--edh";if(t.includes("moxfield.com"))return"btn--mox";if(t.includes("archidekt.com"))return"btn--archi"}catch{}return null},m=(e,t)=>{let n=d(e);if(n==="btn--base"){const e=h(t);e&&(n=e)}return`pill ${n}`},f=(e,n)=>{const s=t(e);if(s)return s;try{const e=new URL(n,window.location.origin).host;return e||"Apri"}catch{return"Apri"}},p=()=>{const e=parseInt(n("p")||"1",10);return isNaN(e)||e<1?1:e},g=()=>{const t=document.documentElement.getAttribute("data-archive-page-size"),e=parseInt(t||"12",10);return isNaN(e)?12:Math.max(5,Math.min(24,e))},v=t(n("q")||""),b=(n("kind")||"").toLowerCase().trim(),u=n=>{const v=s(n.id),y=e(s(n.kind)||"content"),b=t(n.overline||""),l=t(n.title||""),d=t(n.desc||"");let i=t(n.thumb||"");i&&!r(i)&&(i="/"+i.replace(/^\/+/,""));const w=document.documentElement.getAttribute("data-app-ver")||"",g=k(i||"/assets/cards/fblthp_placeholder.webp",w),o=Array.isArray(n.links)?n.links.slice().sort((e,t)=>(e.sort_order??0)-(t.sort_order??0)):[];let a=null;for(let t=0;t<o.length;t++){const n=e(o[t]?.btn_class||"");if(n&&/\bprimary\b/.test(n)){a=t;break}}const u=a!=null?t(o[a].href||""):"",h=[];for(let e=0;e<o.length;e++){if(e===a)continue;const s=o[e],n=t(s?.href||"");if(!n)continue;h.push({url:n,lab:f(s?.label||"",n),cls:m(s?.btn_class||"",n)})}const j=`links-${v.replace(/[^a-zA-Z0-9_-]+/g,"-")}`,c=h.length,_=!!d||c>0,O=c>0?`Dettagli e link (${c})`:"Dettagli",x=c?`<div class="item-ctas" role="group" aria-label="Collegamenti">
           ${h.map(e=>`<a class="${e.cls}" href="${e.url}" target="_blank" rel="noopener" title="${e.lab}">${e.lab}</a>`).join("")}
         </div>`:"",p=document.createElement("li");return p.className=`archive-item is-${y}`,p.innerHTML=`
      <article class="item" data-item-id="${v}" data-kind="${y}">
        <header class="item-head">
          ${b?`<p class="item-overline">${b}</p>`:""}
          <h2 class="item-title">${l}</h2>
        </header>
        ${u?`<a class="item-thumb${u&&/\bprimary\b/.test(e(o[a]?.btn_class||""))?" primary":""}"
                href="${u}" target="_blank" rel="noopener" aria-label="Apri: ${l}">
               <img src="${g}" alt="Anteprima: ${l}" loading="lazy" decoding="async">
             </a>`:`<figure class="item-thumb">
               <img src="${g}" alt="Anteprima: ${l}" loading="lazy" decoding="async">
             </figure>`}
        ${_?`<button class="item-actions-summary" type="button" aria-controls="${j}" aria-expanded="false">
                 <span class="sr-only">${O}</span>
               </button>`:""}
      </article>
      ${_?`<div class="item-panel" id="${j}" hidden>
             ${d?`<div class="item-descbar"><p class="item-summary">${d}</p></div>`:""}
             ${x}
           </div>`:""}
    `,p},y=(t,n,s)=>{const i=e(n).trim(),a=e(s);return t.filter(t=>{if(a&&a!==e(t.kind||""))return!1;if(!i)return!0;const n=o(t.title||"",i)||o(t.overline||"",i)||o(t.desc||"",i),s=j(t.tags||[],i);return n||s})},i=e=>{const t=Date.parse(e);return isNaN(t)?0:t},w=e=>e.slice().sort((e,t)=>{const n=i(e.date),o=i(t.date);if(n!==o)return o-n;const a=s(e.id),r=s(t.id);return a<r?1:a>r?-1:0}),O=(e,t,n)=>{const s=e.length,o=Math.max(1,Math.ceil(s/n)),i=Math.min(Math.max(1,t),o),a=(i-1)*n,r=a+n;return{total:s,pages:o,page:i,slice:e.slice(a,r)}},x=e=>{const i=l(".archive-pager");if(!i)return;const m=a(),{page:t,pages:r}=e,s=i.querySelector('a[rel="prev"]'),o=i.querySelector('a[rel="next"]'),u=i.querySelector(".curr"),h=(e,t)=>{if(!e)return;const s=new URL(m);s.searchParams.set("p",t);const o=n("q"),i=n("kind");o?s.searchParams.set("q",o):s.searchParams.delete("q"),i?s.searchParams.set("kind",i):s.searchParams.delete("kind"),e.href=s.toString()},c=t<=1;s&&(s.classList.toggle("disabled",c),s.setAttribute("aria-disabled",c?"true":"false"),h(s,c?1:t-1),s.rel="prev"),u&&(u.textContent=`Pag. ${t} / ${r}`);const d=t>=r;o&&(o.classList.toggle("disabled",d),o.setAttribute("aria-disabled",d?"true":"false"),h(o,d?r:t+1),o.rel="next")},C=e=>{const t=l(".archive-hero .filter-note strong");t&&(t.textContent=new Intl.NumberFormat("it-IT").format(e))},E=e=>{const i=document.querySelector("section.archive");if(!i)return;const o=i.querySelector(".container")||i;let s=o.querySelector("ol.archive-timeline");if(s||(s=document.createElement("ol"),s.className="archive-timeline",o.appendChild(s)),s.innerHTML="",!e.length){const e=document.createElement("p");e.className="empty",e.setAttribute("role","status"),e.setAttribute("aria-live","polite");const o=t(n("q")||"");e.innerHTML=`Nessun risultato per <em>${o}</em>.`,s.replaceWith(e);return}const r=o.querySelector("p.empty");r&&(r.remove(),s=document.createElement("ol"),s.className="archive-timeline",o.appendChild(s));const a=document.createDocumentFragment();for(const t of e)a.appendChild(u(t));s.appendChild(a)},c=async()=>{try{const n=document.documentElement.getAttribute("data-app-ver")||"",s=n?`?v=${n}`:"",e=await fetch(`/archive/list.json${s}`,{credentials:"same-origin"});if(!e.ok)throw new Error(`HTTP ${e.status}`);const o=await e.json(),i=g(),a=p(),r=y(o,v,b),c=w(r),t=O(c,a,i);C(t.total),E(t.slice),x(t)}catch(e){console.error("[archive] dataset error:",e)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c()})()